#!/bin/bash
# Reset all iptables and share internet from wlan0 -> wlan1

# User variables (edit or pass as args)
IN_IF="${1:-wlan0}"   # Internet interface
AP_IF="${2:-wlan1}"   # Access point interface
SUBNET="${3:-192.168.50.0/24}"  # Hotspot subnet

echo "[+] Resetting iptables rules..."
iptables -F
iptables -t nat -F
iptables -X
iptables -t nat -X

echo "[+] Enabling IP forwarding..."
sysctl -w net.ipv4.ip_forward=1 >/dev/null

echo "[+] Setting up NAT between $IN_IF (internet) and $AP_IF (hotspot)..."
iptables -t nat -A POSTROUTING -o "$IN_IF" -s "$SUBNET" -j MASQUERADE
iptables -A FORWARD -i "$IN_IF" -o "$AP_IF" -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i "$AP_IF" -o "$IN_IF" -j ACCEPT

echo "[+] Internet sharing enabled!"
echo "[i] From: $IN_IF  -->  To: $AP_IF"
